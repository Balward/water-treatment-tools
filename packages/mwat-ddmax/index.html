<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MWAT/DDMAX Compliance Calculator</title>
    <link rel="icon" type="image/png" href="../../city-logos/favicon.png" />

    <!-- External Library Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Local Stylesheets -->
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <div class="header">
        <div class="header-content">
          <div class="header-main">
            <h1>üå°Ô∏è MWAT/DDMAX Compliance Calculator</h1>
            <p>
              Calculate Maximum Weekly Average Temperature and Daily Dissolved Maximum for Colorado CDPHE compliance
            </p>
            <div class="header-nav">
              <a href="../../" class="nav-btn" title="Return to Dashboard">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Dashboard</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="instructions-section">
        <div class="instructions-card">
          <h3>üìù Quick Instructions</h3>
          <ol class="instructions-list">
            <li>
              <strong>Upload Data Files:</strong> Import two CSV or Excel files containing 15-minute temperature sensor data
            </li>
            <li>
              <strong>Define Discharge Periods:</strong> Set start/stop times for when discharge was occurring
            </li>
            <li>
              <strong>Select Analysis Month:</strong> Choose the month for DMR reporting
            </li>
            <li>
              <strong>Calculate Compliance:</strong> Generate MWAT and DDMAX values according to CDPHE regulations
            </li>
            <li>
              <strong>Export Results:</strong> Download compliance report for DMR submission
            </li>
          </ol>
          <p class="instructions-tip">
            üí° <strong>Note:</strong> Weeks spanning month boundaries are assigned to the month where the week ends for DMR reporting.
          </p>
        </div>
      </div>

      <!-- Excel Upload Section -->
      <div class="upload-section">
        <div class="control-card">
          <h3>üìä Temperature Data Import</h3>
          <div class="upload-grid">
            <div class="upload-group">
              <label for="file1Input">Process Sensor 1 Data:</label>
              <div class="file-input-wrapper">
                <input
                  type="file"
                  id="file1Input"
                  class="file-input"
                  accept=".csv,.xls,.xlsx"
                />
                <label for="file1Input" class="btn btn-teal">
                  üìÅ Import Sensor 1 Data
                </label>
              </div>
              <div class="file-status" id="file1Status">No file selected</div>
            </div>

            <div class="upload-group">
              <label for="file2Input">Process Sensor 2 Data:</label>
              <div class="file-input-wrapper">
                <input
                  type="file"
                  id="file2Input"
                  class="file-input"
                  accept=".csv,.xls,.xlsx"
                />
                <label for="file2Input" class="btn btn-teal">
                  üìÅ Import Sensor 2 Data
                </label>
              </div>
              <div class="file-status" id="file2Status">No file selected</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Data Preview Section -->
      <div class="preview-section" id="previewSection" style="display: none">
        <div class="control-card">
          <h3>üìã Data Preview</h3>
          <div class="preview-grid">
            <div class="preview-card" id="sensor1Preview">
              <h4>Sensor 1 Data</h4>
              <div class="preview-stats" id="sensor1Stats"></div>
            </div>
            <div class="preview-card" id="sensor2Preview">
              <h4>Sensor 2 Data</h4>
              <div class="preview-stats" id="sensor2Stats"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Discharge Period Configuration -->
      <div class="discharge-section" id="dischargeSection" style="display: none">
        <div class="control-card">
          <h3>‚è∞ Discharge Period Configuration</h3>
          <div class="discharge-controls">
            <div class="control-group">
              <label for="analysisMonth">Analysis Month:</label>
              <select id="analysisMonth">
                <option value="">Select Month...</option>
                <option value="2024-01">January 2024</option>
                <option value="2024-02">February 2024</option>
                <option value="2024-03">March 2024</option>
                <option value="2024-04">April 2024</option>
                <option value="2024-05">May 2024</option>
                <option value="2024-06">June 2024</option>
                <option value="2024-07">July 2024</option>
                <option value="2024-08">August 2024</option>
                <option value="2024-09">September 2024</option>
                <option value="2024-10">October 2024</option>
                <option value="2024-11">November 2024</option>
                <option value="2024-12">December 2024</option>
                <option value="2025-01">January 2025</option>
                <option value="2025-02">February 2025</option>
                <option value="2025-03">March 2025</option>
                <option value="2025-04">April 2025</option>
                <option value="2025-05">May 2025</option>
                <option value="2025-06">June 2025</option>
                <option value="2025-07">July 2025</option>
                <option value="2025-08">August 2025</option>
                <option value="2025-09">September 2025</option>
                <option value="2025-10">October 2025</option>
                <option value="2025-11">November 2025</option>
                <option value="2025-12">December 2025</option>
              </select>
            </div>

            <div class="control-group">
              <label for="dischargePattern">Discharge Pattern:</label>
              <select id="dischargePattern">
                <option value="single">Single Period</option>
                <option value="daily">Daily Recurring</option>
                <option value="custom">Custom Schedule</option>
              </select>
            </div>
          </div>

          <!-- Single Period Configuration -->
          <div class="discharge-config" id="singlePeriodConfig" style="display: none">
            <h4>Single Discharge Period</h4>
            <div class="period-controls">
              <div class="control-group">
                <label for="singleStartDate">Start Date & Time:</label>
                <input type="datetime-local" id="singleStartDate" />
              </div>
              <div class="control-group">
                <label for="singleEndDate">End Date & Time:</label>
                <input type="datetime-local" id="singleEndDate" />
              </div>
            </div>
          </div>

          <!-- Daily Recurring Configuration -->
          <div class="discharge-config" id="dailyRecurringConfig" style="display: none">
            <h4>Daily Recurring Discharge</h4>
            <div class="period-controls">
              <div class="control-group">
                <label for="dailyStartTime">Daily Start Time:</label>
                <input type="time" id="dailyStartTime" value="06:00" />
              </div>
              <div class="control-group">
                <label for="dailyEndTime">Daily End Time:</label>
                <input type="time" id="dailyEndTime" value="18:00" />
              </div>
              <div class="control-group">
                <label for="dailyStartDate">Period Start Date:</label>
                <input type="date" id="dailyStartDate" />
              </div>
              <div class="control-group">
                <label for="dailyEndDate">Period End Date:</label>
                <input type="date" id="dailyEndDate" />
              </div>
            </div>
          </div>

          <!-- Custom Schedule Configuration -->
          <div class="discharge-config" id="customScheduleConfig" style="display: none">
            <h4>Custom Discharge Schedule</h4>
            <div class="custom-periods" id="customPeriods">
              <!-- Custom periods will be added dynamically -->
            </div>
            <button class="btn btn-secondary" id="addCustomPeriod">
              ‚ûï Add Discharge Period
            </button>
          </div>

          <div class="calculate-section">
            <button class="btn btn-large btn-gold" id="calculateBtn" disabled>
              <span>üßÆ</span>
              <span>Calculate MWAT/DDMAX</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div class="results-section" id="resultsSection" style="display: none">
        <div class="control-card">
          <h3>üìà Compliance Results</h3>
          <div class="results-grid">
            <div class="result-card mwat-card">
              <h4>üå°Ô∏è MWAT Results</h4>
              <div class="result-value" id="mwatValue">---.--¬∞C</div>
              <div class="result-details" id="mwatDetails"></div>
            </div>
            
            <div class="result-card ddmax-card">
              <h4>üíß DDMAX Results</h4>
              <div class="result-value" id="ddmaxValue">---.-- mg/L</div>
              <div class="result-details" id="ddmaxDetails"></div>
            </div>
          </div>

          <div class="results-table-section">
            <h4>üìä Weekly Summary Table</h4>
            <div class="table-container">
              <table class="results-table" id="resultsTable">
                <thead>
                  <tr>
                    <th>Week</th>
                    <th>Date Range</th>
                    <th>DMR Month</th>
                    <th>MWAT (¬∞C)</th>
                    <th>DDMAX (mg/L)</th>
                    <th>Discharge Hours</th>
                  </tr>
                </thead>
                <tbody id="resultsTableBody">
                  <!-- Results will be populated here -->
                </tbody>
              </table>
            </div>
          </div>

          <div class="results-actions">
            <button class="btn btn-green" id="exportExcelBtn">
              <span>üìä</span>
              <span>Export to Excel</span>
            </button>
            <button class="btn btn-gray" id="resetCalculationBtn">
              <span>üîÑ</span>
              <span>New Calculation</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Action Bar -->
    <div class="floating-action-bar">
      <button class="btn btn-gray" onclick="showHelp()">
        ‚ÑπÔ∏è Help & Documentation
      </button>
    </div>

    <!-- Notification System -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Local JavaScript -->
    <script src="script.js"></script>
  </body>
</html>