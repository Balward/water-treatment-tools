<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Streaming Current Analyzer - Data Playground</title>
    <link rel="icon" type="image/png" href="../../city-logos/favicon.png" />

    <!-- External Library Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Local Stylesheets -->
    <link rel="stylesheet" href="styles.css?v=2" />
  </head>

  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loading-content">
        <div class="loading-animation">
          <div class="water-drop">💧</div>
          <div class="waves">
            <div class="wave wave1"></div>
            <div class="wave wave2"></div>
            <div class="wave wave3"></div>
          </div>
        </div>
        <h2>Analyzing Streaming Current Data</h2>
        <p id="loadingText">Parsing streaming current detector data...</p>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>
    </div>

    <div class="header">
      <div class="header-content">
        <div class="header-main">
          <h1>⚡ Streaming Current Analyzer</h1>
          <p>
            Interactive data playground for streaming current detector trial data
          </p>
        </div>
        <div class="header-actions">
          <button
            class="action-btn"
            onclick="window.location.href='../../'"
            title="Return to Dashboard"
          >
            <span>🏠</span>
            <span>Dashboard</span>
          </button>
          <button
            class="action-btn"
            id="exportPdfHeader"
            onclick="generatePdfReport()"
            disabled
          >
            <span>📄</span>
            <span>Export PDF</span>
          </button>
          <button
            class="action-btn btn-help"
            onclick="openHelp()"
            title="View Help Documentation"
          >
            <span>ℹ️</span>
            <span>Help</span>
          </button>
        </div>
      </div>
    </div>

    <div class="container">
      <!-- Quick Start Instructions -->
      <div class="quick-start-section" id="quickStartSection">
        <div class="quick-start-card">
          <h3>🚀 Quick Start</h3>
          <p>Click "Load Data" above to import your streaming current trial data and access the 4 analysis views below:</p>
          <div class="preview-tabs">
            <div class="preview-tab">📈 Parameter Correlation</div>
            <div class="preview-tab">⏱️ Time Series Analysis</div>
            <div class="preview-tab">📊 Distribution Trends</div>
            <div class="preview-tab">🎯 Optimization Insights</div>
          </div>
        </div>
      </div>


      <!-- Main Analysis Tabs -->
      <div class="analysis-container" id="analysisContainer" style="display: none">
        <div class="tabs">
          <button class="tab active" onclick="switchAnalysisTab('correlation')" data-tab="correlation">
            <span>📈</span>
            <span>Parameter Correlation</span>
          </button>
          <button class="tab" onclick="switchAnalysisTab('timeseries')" data-tab="timeseries">
            <span>⏱️</span>
            <span>Time Series</span>
          </button>
          <button class="tab" onclick="switchAnalysisTab('distribution')" data-tab="distribution">
            <span>📊</span>
            <span>Distribution Trends</span>
          </button>
          <button class="tab" onclick="switchAnalysisTab('optimization')" data-tab="optimization">
            <span>🎯</span>
            <span>Optimization Insights</span>
          </button>
        </div>

        <!-- Parameter Correlation Tab -->
        <div class="tab-content active" id="correlation-tab">
          <div class="analysis-section">
            <div class="controls-card">
              <h3>📈 Parameter Correlation Analysis</h3>
              <p>Explore relationships between different variables in your streaming current data.</p>
              
              <div class="control-grid">
                <div class="control-group">
                  <label for="corrXAxis">X-Axis Variable:</label>
                  <select id="corrXAxis">
                    <option value="">Select Variable...</option>
                  </select>
                </div>
                <div class="control-group">
                  <label for="corrYAxis">Y-Axis Variable:</label>
                  <select id="corrYAxis">
                    <option value="">Select Variable...</option>
                  </select>
                </div>
                <div class="control-group">
                  <label for="corrColorBy">Color By:</label>
                  <select id="corrColorBy">
                    <option value="">No Grouping</option>
                  </select>
                </div>
              </div>
              
              <button class="btn btn-primary" onclick="updateCorrelationChart()">
                📈 Update Chart
              </button>
            </div>
            
            <div class="chart-container">
              <div id="correlationTitle" class="chart-title"></div>
              <div class="chart-canvas-container">
                <canvas id="correlationChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Time Series Tab -->
        <div class="tab-content" id="timeseries-tab">
          <div class="analysis-section">
            <div class="controls-card">
              <h3>⏱️ Time Series Analysis</h3>
              <p>Track how variables change over time during the trial.</p>
              
              <div class="control-grid">
                <div class="control-group">
                  <label for="timeVar">Time Variable:</label>
                  <select id="timeVar">
                    <option value="">Select Time Variable...</option>
                  </select>
                </div>
              </div>
              
              <div class="variable-selection">
                <label>Variables to Plot (select up to 4):</label>
                <div class="control-grid">
                  <div class="control-group">
                    <label for="timeVar1">Variable 1:</label>
                    <select id="timeVar1">
                      <option value="">Select Variable...</option>
                    </select>
                  </div>
                  <div class="control-group">
                    <label for="timeVar2">Variable 2:</label>
                    <select id="timeVar2">
                      <option value="">Select Variable...</option>
                    </select>
                  </div>
                  <div class="control-group">
                    <label for="timeVar3">Variable 3:</label>
                    <select id="timeVar3">
                      <option value="">Select Variable...</option>
                    </select>
                  </div>
                  <div class="control-group">
                    <label for="timeVar4">Variable 4:</label>
                    <select id="timeVar4">
                      <option value="">Select Variable...</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <button class="btn btn-primary" onclick="updateTimeSeriesChart()">
                ⏱️ Update Chart
              </button>
            </div>
            
            <div class="chart-container">
              <div id="timeSeriesTitle" class="chart-title"></div>
              <div class="chart-canvas-container">
                <canvas id="timeSeriesChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Distribution Trends Tab -->
        <div class="tab-content" id="distribution-tab">
          <div class="analysis-section">
            <div class="controls-card">
              <h3>📊 Distribution Trends</h3>
              <p>Analyze the distribution and variability of your process parameters.</p>
              
              <div class="control-grid">
                <div class="control-group">
                  <label for="distVariable">Variable to Analyze:</label>
                  <select id="distVariable">
                    <option value="">Select Variable...</option>
                  </select>
                </div>
                <div class="control-group">
                  <label for="distBins">Number of Bins:</label>
                  <select id="distBins">
                    <option value="auto" selected>Auto (Dynamic)</option>
                    <option value="5">5 bins</option>
                    <option value="10">10 bins</option>
                    <option value="15">15 bins</option>
                    <option value="20">20 bins</option>
                    <option value="25">25 bins</option>
                  </select>
                </div>
              </div>
              
              <button class="btn btn-primary" onclick="updateDistributionChart()">
                📊 Update Chart
              </button>
            </div>
            
            <div class="charts-row">
              <div class="chart-container">
                <div id="histogramTitle" class="chart-title"></div>
                <div class="chart-canvas-container">
                  <canvas id="histogramChart"></canvas>
                </div>
              </div>
              <div class="stats-card">
                <h4>📈 Statistical Summary</h4>
                <div id="distributionStats"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Optimization Insights Tab -->
        <div class="tab-content" id="optimization-tab">
          <div class="analysis-section">
            <div class="controls-card">
              <h3>🎯 Optimization Insights</h3>
              <p>Find correlations and patterns to optimize your target parameter.</p>
              
              <div class="control-grid">
                <div class="control-group">
                  <label for="targetVariable">Optimization Target:</label>
                  <select id="targetVariable">
                    <option value="">Select Target...</option>
                  </select>
                </div>
                <div class="control-group">
                  <label for="minCorrelation">Minimum Correlation:</label>
                  <select id="minCorrelation">
                    <option value="0.3">0.3 (Weak)</option>
                    <option value="0.5" selected>0.5 (Moderate)</option>
                    <option value="0.7">0.7 (Strong)</option>
                  </select>
                </div>
              </div>
              
              <button class="btn btn-primary" onclick="updateOptimizationInsights()">
                🎯 Analyze Correlations
              </button>
            </div>
            
            <div class="insights-grid">
              <div class="correlation-matrix-card">
                <h4>🔗 Correlation Matrix</h4>
                <div id="correlationMatrix"></div>
              </div>
              <div class="optimization-chart-container">
                <div id="optimizationTitle" class="chart-title"></div>
                <div class="chart-canvas-container">
                  <canvas id="optimizationChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="help-modal" style="display: none">
      <div class="help-modal-content">
        <button class="modal-close-x" onclick="closeHelp()" title="Close">
          &times;
        </button>
        <h3>📖 Streaming Current Analyzer - User Guide</h3>

        <div class="help-section">
          <h4>📈 Parameter Correlation</h4>
          <p>
            Explore relationships between any two variables in your dataset. Use color grouping to identify patterns
            within different segments of your data. Perfect for understanding how Alum Dose affects Streaming Current
            or other process parameters.
          </p>
        </div>

        <div class="help-section">
          <h4>⏱️ Time Series Analysis</h4>
          <p>
            Track how multiple variables change over time during your trial run. Select up to several variables
            to plot simultaneously and observe trends, peaks, and patterns throughout the test period.
          </p>
        </div>

        <div class="help-section">
          <h4>📊 Distribution Trends</h4>
          <p>
            Analyze the statistical distribution of any parameter. View histograms and summary statistics
            to understand variability, identify outliers, and assess process stability.
          </p>
        </div>

        <div class="help-section">
          <h4>🎯 Optimization Insights</h4>
          <p>
            Find the strongest correlations with your target optimization parameter. Set a correlation threshold
            to identify which variables have the most significant impact on your target outcome.
          </p>
        </div>

        <div class="help-section">
          <h4>💡 Getting Started Tips</h4>
          <ul>
            <li>Start with Parameter Correlation using Streaming Current vs Alum Dose</li>
            <li>Use Time Series to see how both parameters evolve during the trial</li>
            <li>Check Distribution Trends to understand process variability</li>
            <li>Use Optimization Insights to find the best predictors for your target outcome</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Notification System -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Local JavaScript -->
    <script src="script.js?v=2"></script>
  </body>
</html>