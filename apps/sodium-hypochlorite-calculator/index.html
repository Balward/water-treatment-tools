<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sodium Hypochlorite Filter Dosing Calculator</title>
    <link rel="icon" type="image/png" href="../../assets/logos/favicon.png" />
    <link rel="stylesheet" href="../../global-styles.css" />
    <style>
        /* App-specific styles that extend the global system */
        .result-highlight {
            font-size: 2.5rem;
            font-weight: var(--font-weight-black);
            color: var(--success-green);
            margin-bottom: var(--space-3);
            text-align: center;
        }
        
        .result-secondary {
            font-size: 2rem;
            font-weight: var(--font-weight-bold);
            color: var(--success-green);
            margin-bottom: var(--space-4);
            text-align: center;
        }
        
        .calculation-step {
            margin: var(--space-4) 0;
            padding: var(--space-4);
            background: var(--white);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--info-blue);
        }
        
        .formula-display {
            background: var(--gray-200);
            padding: var(--space-3);
            border-radius: var(--radius-sm);
            margin: var(--space-3) 0;
            font-weight: var(--font-weight-bold);
            color: var(--gray-700);
        }
        
        .constants-info {
            margin-top: var(--space-4);
            padding: var(--space-3);
            background: rgba(33, 150, 243, 0.1);
            border-radius: var(--radius-sm);
        }
    </style>
</head>
<body>
    <div class="wt-container">
      <header class="wt-header">
        <div class="wt-header-content">
          <div class="wt-brand">
            <img
              src="../../assets/logos/logo-vert.png"
              alt="City Logo"
              class="wt-logo"
            />
            <div class="wt-brand-text">
              <h1>Sodium Hypochlorite Filter Dosing Calculator</h1>
              <p class="wt-tagline">
                Calculate chemical addition to filter basins for residual increase
              </p>
            </div>
          </div>
          <nav class="wt-nav">
            <a href="../dashboard/dashboard.html" class="wt-nav-link">
              üè† Dashboard
            </a>
          </nav>
        </div>
      </header>

      <main>
        <div class="wt-card">
            <h3 class="text-2xl font-bold text-primary mb-6">Filter Basin Parameters</h3>
            
            <div class="wt-form-group">
                <label for="basinVolume" class="wt-label">Filter Basin Volume (gallons):</label>
                <input type="number" id="basinVolume" step="1" min="0" value="35400" placeholder="Enter basin volume" class="wt-input">
                <small class="text-sm text-gray-500 mt-1 block">
                    <em>Note: Our filters are typically 35,000 gallons</em>
                </small>
            </div>
            
            <div class="wt-form-group">
                <label for="hypochloriteConcentration" class="wt-label">Sodium Hypochlorite Concentration (%):</label>
                <input type="number" id="hypochloriteConcentration" step="0.1" min="0" max="100" value="10" placeholder="Enter concentration" class="wt-input">
                <small class="text-sm text-gray-500 mt-1 block">
                    <em>Note: Our normal hypochlorite concentration is 10%</em>
                </small>
            </div>

            <div class="wt-form-group">
                <label for="residualIncrease" class="wt-label">Desired Filter Basin Residual Increase (mg/L or ppm):</label>
                <input type="number" id="residualIncrease" step="0.1" min="0" placeholder="Enter desired residual increase (e.g., 1.0)" class="wt-input">
            </div>

            <button onclick="calculateDosage()" class="wt-btn wt-btn-primary wt-btn-lg">Calculate Filter Basin Dosage</button>
        </div>

        <div id="result" class="wt-card mt-6" style="display: none; background: linear-gradient(145deg, #d4edda, #c3e6cb); border-left: 5px solid var(--success-green);">
            <h3 class="text-xl font-bold text-success flex items-center mb-4">
                üß™ Filter Basin Dosage Required
            </h3>
            <div id="dosageAmount"></div>
            <div id="dosageVolume"></div>
            
            <div id="calculations" class="wt-card mt-6 bg-gray-50">
                <h4 class="text-lg font-semibold text-gray-700 flex items-center mb-4">
                    üìä How This Was Calculated
                </h4>
                <div class="formula-display">
                    Basic Formula: Dosage (lbs) = (Desired mg/L √ó Volume MG √ó 8.34) √∑ (Chemical Strength √ó Available Chlorine)<br>
                    Volume (gal) = Dosage (lbs) √∑ (Specific Gravity √ó 8.34)
                </div>
                
                <div id="step1" class="calculation-step"></div>
                <div id="step2" class="calculation-step"></div>
                <div id="step3" class="calculation-step"></div>
                <div id="step4" class="calculation-step"></div>
                
                <div class="constants-info">
                    <strong>Key Constants:</strong><br>
                    ‚Ä¢ 8.34 = lbs per gallon of water<br>
                    ‚Ä¢ 1.1 = specific gravity of 10% sodium hypochlorite<br>
                    ‚Ä¢ 0.96 = available chlorine factor (96%)<br>
                    ‚Ä¢ MG = million gallons (basin volume √∑ 1,000,000)<br>
                    ‚Ä¢ 128 = fluid ounces per gallon<br>
                    ‚Ä¢ 3,785.41 = milliliters per gallon
                </div>
            </div>
            
            <div class="wt-card mt-4" style="background: #fff3cd; border-left: 4px solid var(--warning-amber);">
                <strong>‚ö†Ô∏è Important Note:</strong> This calculation is for filter basin chemical addition to increase residual levels. It assumes uniform mixing and does not account for chlorine demand or decay. Always verify with residual testing and adjust based on actual filter basin conditions.
            </div>
        </div>

        <div id="error" class="wt-card mt-4" style="display: none; background: linear-gradient(145deg, #f8d7da, #f5c6cb); border-left: 5px solid var(--error-red); color: #721c24;"></div>
      </main>
    </div>
    
    <!-- Floating Error Banner -->
    <div id="errorBanner" class="wt-notification error">
        <span id="errorBannerMessage"></span>
    </div>
    
    <!-- Floating Warning Banner -->
    <div id="warningBanner" class="wt-notification warning">
        <span id="warningBannerMessage"></span>
    </div>

    <script>
        function showErrorBanner(message) {
            const banner = document.getElementById('errorBanner');
            const messageElement = document.getElementById('errorBannerMessage');
            
            messageElement.textContent = message;
            banner.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                hideErrorBanner();
            }, 5000);
        }
        
        function hideErrorBanner() {
            const banner = document.getElementById('errorBanner');
            banner.classList.remove('show');
        }
        
        function showWarningBanner(message) {
            const banner = document.getElementById('warningBanner');
            const messageElement = document.getElementById('warningBannerMessage');
            
            messageElement.textContent = message;
            banner.classList.add('show');
            
            // Auto-hide after 7 seconds for warnings
            setTimeout(() => {
                hideWarningBanner();
            }, 7000);
        }
        
        function hideWarningBanner() {
            const banner = document.getElementById('warningBanner');
            banner.classList.remove('show');
        }
        
        function calculateDosage() {
            const residualIncrease = parseFloat(document.getElementById('residualIncrease').value);
            const basinVolume = parseFloat(document.getElementById('basinVolume').value);
            const hypochloriteConcentrationPercent = parseFloat(document.getElementById('hypochloriteConcentration').value);
            const errorDiv = document.getElementById('error');
            const resultDiv = document.getElementById('result');
            
            // Hide old banners
            hideErrorBanner();
            hideWarningBanner();
            errorDiv.style.display = 'none';
            resultDiv.style.display = 'none';
            
            // Validation
            if (isNaN(residualIncrease) || residualIncrease <= 0) {
                showErrorBanner('Please enter a valid positive number for residual increase.');
                return;
            }
            
            if (isNaN(basinVolume) || basinVolume <= 0) {
                showErrorBanner('Please enter a valid positive number for basin volume.');
                return;
            }
            
            if (isNaN(hypochloriteConcentrationPercent) || hypochloriteConcentrationPercent <= 0 || hypochloriteConcentrationPercent > 100) {
                showErrorBanner('Please enter a valid concentration between 0 and 100%.');
                return;
            }
            
            if (residualIncrease > 10) {
                showWarningBanner('Warning: Residual increase over 10 mg/L is unusually high. Please verify your input.');
            }
            
            // Constants and conversions
            const hypochloriteConcentration = hypochloriteConcentrationPercent / 100; // Convert % to decimal
            const basinVolumeMG = basinVolume / 1000000; // Convert gallons to million gallons
            const specificGravity = 1.1; // Specific gravity of 10% sodium hypochlorite
            const availableChlorine = 0.96; // 96% available chlorine
            
            // Main calculation - Standard water treatment formula
            // Chemical needed (lbs) = (Desired mg/L √ó Water volume MG √ó 8.34) √∑ (Chemical purity √ó Available chlorine)
            const dosageLbsPerDay = (residualIncrease * basinVolumeMG * 8.34) / (hypochloriteConcentration * availableChlorine);
            
            // Convert pounds to gallons: Gallons = lbs √∑ (specific gravity √ó 8.34)
            const dosageGallons = dosageLbsPerDay / (specificGravity * 8.34);
            const dosageOunces = dosageGallons * 128;
            const dosageMl = dosageGallons * 3785.41;
            
            // Display results
            document.getElementById('dosageAmount').innerHTML = 
                `<div class="text-center mb-6">
                    <div class="result-highlight">
                        ${dosageGallons.toFixed(2)} gallons
                    </div>
                    <div class="result-secondary">
                        ${dosageMl.toFixed(0)} mL
                    </div>
                    <div class="text-lg text-gray-600">
                        (${dosageLbsPerDay.toFixed(4)} lbs of ${hypochloriteConcentrationPercent}% sodium hypochlorite solution)
                    </div>
                </div>`;
            
            document.getElementById('dosageVolume').innerHTML = '';
            
            // Show calculation steps
            document.getElementById('step1').innerHTML = 
                `<strong>Step 1: Convert basin volume to million gallons</strong><br>
                <em>Water treatment calculations use million gallons (MG) as the standard unit for large volumes.</em><br>
                Volume (MG) = ${basinVolume.toLocaleString()} gal √∑ 1,000,000 = <strong>${basinVolumeMG.toFixed(6)} MG</strong><br>
                <small style="color: #6c757d; margin-top: 5px; display: block;">This conversion allows us to use the standard water treatment dosing formula.</small>`;
            
            document.getElementById('step2').innerHTML = 
                `<strong>Step 2: Calculate chemical weight needed</strong><br>
                <em>Using the standard water treatment formula: Chemical weight = (Target concentration √ó Volume √ó Water density) √∑ (Chemical strength √ó Available chlorine)</em><br>
                Dosage (lbs) = (${residualIncrease} mg/L √ó ${basinVolumeMG.toFixed(6)} MG √ó 8.34) √∑ (${hypochloriteConcentration.toFixed(2)} √ó ${availableChlorine})<br>
                Dosage (lbs) = ${(residualIncrease * basinVolumeMG * 8.34).toFixed(6)} √∑ ${(hypochloriteConcentration * availableChlorine).toFixed(3)} = <strong>${dosageLbsPerDay.toFixed(4)} lbs</strong><br>
                <small style="color: #6c757d; margin-top: 5px; display: block;">
                    ‚Ä¢ 8.34 = lbs per gallon of water (density conversion factor)<br>
                    ‚Ä¢ ${hypochloriteConcentration.toFixed(2)} = ${hypochloriteConcentrationPercent}% sodium hypochlorite concentration as decimal<br>
                    ‚Ä¢ ${availableChlorine} = available chlorine factor (only 96% of the hypochlorite is available for disinfection)
                </small>`;
            
            document.getElementById('step3').innerHTML = 
                `<strong>Step 3: Convert chemical weight to solution volume</strong><br>
                <em>Convert pounds of chemical needed to gallons of solution required using the solution's specific gravity.</em><br>
                Volume (gal) = ${dosageLbsPerDay.toFixed(4)} lbs √∑ (${specificGravity} √ó 8.34)<br>
                Volume (gal) = ${dosageLbsPerDay.toFixed(4)} √∑ ${(specificGravity * 8.34).toFixed(2)} = <strong>${dosageGallons.toFixed(4)} gallons</strong><br>
                <small style="color: #6c757d; margin-top: 5px; display: block;">
                    ‚Ä¢ ${specificGravity} = specific gravity of ${hypochloriteConcentrationPercent}% sodium hypochlorite solution (heavier than water)<br>
                    ‚Ä¢ 8.34 = conversion factor to get solution weight per gallon
                </small>`;
            
            document.getElementById('step4').innerHTML = 
                `<strong>Final Result Summary</strong><br>
                <em>For a ${basinVolume.toLocaleString()}-gallon filter basin using ${hypochloriteConcentrationPercent}% sodium hypochlorite to achieve a ${residualIncrease} mg/L residual increase:</em><br><br>
                <strong>Required dosage:</strong> ${dosageGallons.toFixed(4)} gallons (${dosageMl.toFixed(0)} mL)<br>
                <strong>Chemical weight:</strong> ${dosageLbsPerDay.toFixed(4)} lbs of active chlorine<br>
                <small style="color: #6c757d; margin-top: 8px; display: block;">
                    This calculation accounts for the solution's specific gravity, available chlorine content, and uses standard water treatment industry formulas for accurate dosing.
                </small>`;
            
            resultDiv.style.display = 'block';
            
            // Smooth scroll to results
            setTimeout(() => {
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
        
        document.getElementById('residualIncrease').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateDosage();
            }
        });
        
        // Add input validation styling
        document.getElementById('residualIncrease').addEventListener('input', function(e) {
            const value = parseFloat(e.target.value);
            if (value > 10) {
                e.target.style.borderColor = '#ffc107';
                e.target.style.backgroundColor = '#fff3cd';
            } else if (value > 0) {
                e.target.style.borderColor = '#00677f';
                e.target.style.backgroundColor = '#e8f4f6';
            } else {
                e.target.style.borderColor = '#e9ecef';
                e.target.style.backgroundColor = 'white';
            }
        });
    </script>
</body>
</html>